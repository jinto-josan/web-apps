@startuml Identity-Auth Service - Logout
skinparam fontName "Helvetica"
skinparam titleFontName "Helvetica"
skinparam legendFontName "Helvetica"
skinparam noteFontName "Helvetica"
autonumber
actor Client as Client
participant "AuthController" as Controller
participant "LogoutUseCase" as LogoutUC
participant "SessionRepository" as SessionRepo
participant "RefreshTokenRepository" as RefreshRepo
participant "Azure Cache for Redis" as Redis

Client -> Controller: POST /auth/logout { sessionId? }
Controller -> LogoutUC: execute(sessionId from JWT or body)
LogoutUC -> SessionRepo: revoke(sessionId, "logout")
LogoutUC -> RefreshRepo: revokeChain(startingId, "logout")
LogoutUC -> Redis: DEL session:jti:{jti}
LogoutUC --> Controller: 204
Controller --> Client: 204
@enduml
