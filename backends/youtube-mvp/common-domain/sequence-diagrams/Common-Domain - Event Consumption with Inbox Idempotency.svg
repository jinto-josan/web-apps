<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="1172px" preserveAspectRatio="none" style="width:1965px;height:1172px;background:#FFFFFF;" version="1.1" viewBox="0 0 1965 1172" width="1965px" zoomAndPan="magnify"><title>Common-Domain - Event Consumption with Inbox Idempotency</title><defs/><g><text fill="#000000" font-family="'Helvetica'" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="424.6689" x="771.4426" y="25.7803">Common-Domain - Event Consumption with Inbox Idempotency</text><rect fill="none" height="752.6738" style="stroke:#000000;stroke-width:1.5;" width="1948.5542" x="10" y="324.6621"/><rect fill="none" height="383.9922" style="stroke:#000000;stroke-width:1.5;" width="1455.481" x="20" y="686.3438"/><g><title>Azure Service Bus Topic</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="116.9409" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="120" x2="120" y1="102.4883" y2="1094.3359"/></g><g><title>EventProcessor .Worker.</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="550.0229" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="553.1489" x2="553.1489" y1="102.4883" y2="1094.3359"/></g><g><title>Tracer</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="825.1436" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="828.6377" x2="828.6377" y1="102.4883" y2="1094.3359"/></g><g><title>InboxRepository</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="926.0718" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="929.6494" x2="929.6494" y1="102.4883" y2="1094.3359"/></g><g><title>Azure SQL</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1215.7285" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1219.6226" x2="1219.6226" y1="102.4883" y2="1094.3359"/></g><g><title>EventRouter</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1311.5664" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1314.8345" x2="1314.8345" y1="102.4883" y2="1094.3359"/></g><g><title>UnitOfWork</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1415.3896" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1419.2983" x2="1419.2983" y1="102.4883" y2="1094.3359"/></g><g><title>EventHandler</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1523.3076" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1526.481" x2="1526.481" y1="102.4883" y2="1094.3359"/></g><g><title>Repository</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1669.647" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1673.584" x2="1673.584" y1="102.4883" y2="1094.3359"/></g><g><title>OutboxRepository</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1824.9741" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1828.5122" x2="1828.5122" y1="102.4883" y2="1094.3359"/></g><g><title>Agg</title><rect fill="#000000" fill-opacity="0.00000" height="991.8477" width="8" x="1923.9951" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1927.436" x2="1927.436" y1="102.4883" y2="1094.3359"/></g><g class="participant participant-head" data-participant="ASB"><path d="M35,76 L206.8818,76 C211.8818,76 211.8818,89.2441 211.8818,89.2441 C211.8818,89.2441 211.8818,102.4883 206.8818,102.4883 L35,102.4883 C30,102.4883 30,89.2441 30,89.2441 C30,89.2441 30,76 35,76" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M206.8818,76 C201.8818,76 201.8818,89.2441 201.8818,89.2441 C201.8818,102.4883 206.8818,102.4883 206.8818,102.4883" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161.8818" x="35" y="94.5352">Azure Service Bus Topic</text></g><g class="participant participant-tail" data-participant="ASB"><path d="M35,1093.3359 L206.8818,1093.3359 C211.8818,1093.3359 211.8818,1106.5801 211.8818,1106.5801 C211.8818,1106.5801 211.8818,1119.8242 206.8818,1119.8242 L35,1119.8242 C30,1119.8242 30,1106.5801 30,1106.5801 C30,1106.5801 30,1093.3359 35,1093.3359" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M206.8818,1093.3359 C201.8818,1093.3359 201.8818,1106.5801 201.8818,1106.5801 C201.8818,1119.8242 206.8818,1119.8242 206.8818,1119.8242" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161.8818" x="35" y="1111.8711">Azure Service Bus Topic</text></g><g class="participant participant-head" data-participant="Processor"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177.748" x="465.1489" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163.748" x="472.1489" y="91.5352">EventProcessor (Worker)</text></g><g class="participant participant-tail" data-participant="Processor"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="177.748" x="465.1489" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="163.748" x="472.1489" y="1113.8711">EventProcessor (Worker)</text></g><g class="participant participant-head" data-participant="Tracer"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57.0117" x="800.6377" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.0117" x="807.6377" y="91.5352">Tracer</text></g><g class="participant participant-tail" data-participant="Tracer"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57.0117" x="800.6377" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.0117" x="807.6377" y="1113.8711">Tracer</text></g><g class="participant participant-head" data-participant="Inbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.8447" x="867.6494" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.8447" x="874.6494" y="91.5352">InboxRepository</text></g><g class="participant participant-tail" data-participant="Inbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="124.8447" x="867.6494" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="110.8447" x="874.6494" y="1113.8711">InboxRepository</text></g><g class="participant participant-head" data-participant="SQL"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.2119" x="1181.6226" y="99.5352">Azure SQL</text><path d="M1201.7285,50 C1201.7285,40 1219.7285,40 1219.7285,40 C1219.7285,40 1237.7285,40 1237.7285,50 L1237.7285,76 C1237.7285,86 1219.7285,86 1219.7285,86 C1219.7285,86 1201.7285,86 1201.7285,76 L1201.7285,50" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1201.7285,50 C1201.7285,60 1219.7285,60 1219.7285,60 C1219.7285,60 1237.7285,60 1237.7285,50" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="SQL"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.2119" x="1181.6226" y="1106.8711">Azure SQL</text><path d="M1201.7285,1119.8242 C1201.7285,1109.8242 1219.7285,1109.8242 1219.7285,1109.8242 C1219.7285,1109.8242 1237.7285,1109.8242 1237.7285,1119.8242 L1237.7285,1145.8242 C1237.7285,1155.8242 1219.7285,1155.8242 1219.7285,1155.8242 C1219.7285,1155.8242 1201.7285,1155.8242 1201.7285,1145.8242 L1201.7285,1119.8242" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1201.7285,1119.8242 C1201.7285,1129.8242 1219.7285,1129.8242 1219.7285,1129.8242 C1219.7285,1129.8242 1237.7285,1129.8242 1237.7285,1119.8242" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Router"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.4639" x="1267.8345" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.4639" x="1274.8345" y="91.5352">EventRouter</text></g><g class="participant participant-tail" data-participant="Router"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95.4639" x="1267.8345" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81.4639" x="1274.8345" y="1113.8711">EventRouter</text></g><g class="participant participant-head" data-participant="UoW"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92.1826" x="1373.2983" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.1826" x="1380.2983" y="91.5352">UnitOfWork</text></g><g class="participant participant-tail" data-participant="UoW"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="92.1826" x="1373.2983" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="78.1826" x="1380.2983" y="1113.8711">UnitOfWork</text></g><g class="participant participant-head" data-participant="Handler"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.6533" x="1475.481" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.6533" x="1482.481" y="91.5352">EventHandler</text></g><g class="participant participant-tail" data-participant="Handler"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="103.6533" x="1475.481" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="89.6533" x="1482.481" y="1113.8711">EventHandler</text></g><g class="participant participant-head" data-participant="Repo"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.126" x="1630.584" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.126" x="1637.584" y="91.5352">Repository</text></g><g class="participant participant-tail" data-participant="Repo"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.126" x="1630.584" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.126" x="1637.584" y="1113.8711">Repository</text></g><g class="participant participant-head" data-participant="Outbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.9238" x="1760.5122" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9238" x="1767.5122" y="91.5352">OutboxRepository</text></g><g class="participant participant-tail" data-participant="Outbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.9238" x="1760.5122" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9238" x="1767.5122" y="1113.8711">OutboxRepository</text></g><g class="participant participant-head" data-participant="Agg"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41.1182" x="1907.436" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.1182" x="1914.436" y="91.5352">Agg</text></g><g class="participant participant-tail" data-participant="Agg"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41.1182" x="1907.436" y="1093.3359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27.1182" x="1914.436" y="1113.8711">Agg</text></g><g class="message" data-participant-1="ASB" data-participant-2="Processor"><polygon fill="#181818" points="542.0229,129.7988,552.0229,133.7988,542.0229,137.7988,546.0229,133.7988" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="120.9409" x2="548.0229" y1="133.7988" y2="133.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="127.9409" y="129.0566">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="396.5063" x="140.5166" y="129.0566">receive(message, props{messageId, correlationId, traceparent})</text></g><g class="message" data-participant-1="Processor" data-participant-2="Tracer"><polygon fill="#181818" points="817.1436,159.1094,827.1436,163.1094,817.1436,167.1094,821.1436,163.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="823.1436" y1="163.1094" y2="163.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="561.0229" y="158.3672">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="238.5449" x="573.5986" y="158.3672">startSpan("handle event", traceparent)</text></g><g class="message" data-participant-1="Tracer" data-participant-2="Processor"><polygon fill="#181818" points="565.0229,188.4199,555.0229,192.4199,565.0229,196.4199,561.0229,192.4199" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="559.0229" x2="828.1436" y1="192.4199" y2="192.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="571.0229" y="187.6777">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.5986" x="583.5986" y="187.6777">active span</text></g><g class="message" data-participant-1="Processor" data-participant-2="Inbox"><polygon fill="#181818" points="918.0718,217.7305,928.0718,221.7305,918.0718,225.7305,922.0718,221.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="924.0718" y1="221.7305" y2="221.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="561.0229" y="216.9883">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.5454" x="573.5986" y="216.9883">beginProcess(messageId)</text></g><g class="message" data-participant-1="Inbox" data-participant-2="SQL"><polygon fill="#181818" points="1207.7285,247.041,1217.7285,251.041,1207.7285,255.041,1211.7285,251.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="930.0718" x2="1213.7285" y1="251.041" y2="251.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="937.0718" y="246.2988">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.1685" x="949.6475" y="246.2988">INSERT messageId IF NOT EXISTS</text></g><g class="message" data-participant-1="SQL" data-participant-2="Inbox"><polygon fill="#181818" points="941.0718,276.3516,931.0718,280.3516,941.0718,284.3516,937.0718,280.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="935.0718" x2="1218.7285" y1="280.3516" y2="280.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="947.0718" y="275.6094">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131.2505" x="959.6475" y="275.6094">inserted? (true/false)</text></g><g class="message" data-participant-1="Inbox" data-participant-2="Processor"><polygon fill="#181818" points="565.0229,305.6621,555.0229,309.6621,565.0229,313.6621,561.0229,309.6621" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="559.0229" x2="929.0718" y1="309.6621" y2="309.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="571.0229" y="304.9199">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118.7393" x="583.5986" y="304.9199">started (true/false)</text></g><path d="M10,324.6621 L72.1387,324.6621 L72.1387,331.9727 L62.1387,341.9727 L10,341.9727 L10,324.6621" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="752.6738" style="stroke:#000000;stroke-width:1.5;" width="1948.5542" x="10" y="324.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="25" y="338.2305">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="148.4678" x="87.1387" y="337.2969">[duplicate (started=false)]</text><g class="message" data-participant-1="Processor" data-participant-2="ASB"><polygon fill="#181818" points="131.9409,359.2832,121.9409,363.2832,131.9409,367.2832,127.9409,363.2832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="125.9409" x2="553.0229" y1="363.2832" y2="363.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="137.9409" y="358.541">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="246.7207" x="150.5166" y="358.541">complete(message) ' already processed</text></g><g class="message" data-participant-1="Processor" data-participant-2="Tracer"><polygon fill="#181818" points="817.1436,388.5938,827.1436,392.5938,817.1436,396.5938,821.1436,392.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="823.1436" y1="392.5938" y2="392.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="561.0229" y="387.8516">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.3784" x="573.5986" y="387.8516">endSpan()</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="10" x2="1958.5542" y1="401.5938" y2="401.5938"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="148.1348" x="15" y="412.2285">[first-time (started=true)]</text><g class="message" data-participant-1="Processor" data-participant-2="UoW"><polygon fill="#181818" points="1407.3896,432.8594,1417.3896,436.8594,1407.3896,440.8594,1411.3896,436.8594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="1413.3896" y1="436.8594" y2="436.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="432.1172">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.8115" x="582.1743" y="432.1172">begin()</text></g><g class="message" data-participant-1="Processor" data-participant-2="Router"><polygon fill="#181818" points="1303.5664,462.1699,1313.5664,466.1699,1303.5664,470.1699,1307.5664,466.1699" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="1309.5664" y1="466.1699" y2="466.1699"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="461.4277">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="189.0142" x="582.1743" y="461.4277">resolveHandler(message.type)</text></g><g class="message" data-participant-1="Router" data-participant-2="Processor"><polygon fill="#181818" points="565.0229,491.4805,555.0229,495.4805,565.0229,499.4805,561.0229,495.4805" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="559.0229" x2="1314.5664" y1="495.4805" y2="495.4805"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="571.0229" y="490.7383">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49.3022" x="592.1743" y="490.7383">Handler</text></g><g class="message" data-participant-1="Processor" data-participant-2="Handler"><polygon fill="#181818" points="1515.3076,520.791,1525.3076,524.791,1515.3076,528.791,1519.3076,524.791" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="1521.3076" y1="524.791" y2="524.791"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="520.0488">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="220.4985" x="582.1743" y="520.0488">handle(domainEvent, correlationId)</text></g><g class="message" data-participant-1="Handler" data-participant-2="Repo"><polygon fill="#181818" points="1661.647,550.1016,1671.647,554.1016,1661.647,558.1016,1665.647,554.1016" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1527.3076" x2="1667.647" y1="554.1016" y2="554.1016"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1534.3076" y="549.3594">14</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.188" x="1555.459" y="549.3594">load aggregates</text></g><g class="message" data-participant-1="Repo" data-participant-2="Handler"><polygon fill="#181818" points="1538.3076,579.4121,1528.3076,583.4121,1538.3076,587.4121,1534.3076,583.4121" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1532.3076" x2="1672.647" y1="583.4121" y2="583.4121"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1544.3076" y="578.6699">15</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="25.1812" x="1565.459" y="578.6699">Agg</text></g><g class="message" data-participant-1="Handler" data-participant-2="Agg"><polygon fill="#181818" points="1915.9951,608.7227,1925.9951,612.7227,1915.9951,616.7227,1919.9951,612.7227" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1527.3076" x2="1921.9951" y1="612.7227" y2="612.7227"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1534.3076" y="607.9805">16</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122.9985" x="1555.459" y="607.9805">apply(event effects)</text></g><g class="message" data-participant-1="Handler" data-participant-2="Repo"><polygon fill="#181818" points="1661.647,638.0332,1671.647,642.0332,1661.647,646.0332,1665.647,642.0332" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1527.3076" x2="1667.647" y1="642.0332" y2="642.0332"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1534.3076" y="637.291">17</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="61.4136" x="1555.459" y="637.291">save(Agg)</text></g><g class="message" data-participant-1="Handler" data-participant-2="Outbox"><polygon fill="#181818" points="1816.9741,667.3438,1826.9741,671.3438,1816.9741,675.3438,1820.9741,671.3438" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1527.3076" x2="1822.9741" y1="671.3438" y2="671.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1534.3076" y="666.6016">18</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.5151" x="1555.459" y="666.6016">append(new domain events, metadata...)</text></g><path d="M20,686.3438 L82.1387,686.3438 L82.1387,693.6543 L72.1387,703.6543 L20,703.6543 L20,686.3438" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="383.9922" style="stroke:#000000;stroke-width:1.5;" width="1455.481" x="20" y="686.3438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="35" y="699.9121">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="52.1909" x="97.1387" y="698.9785">[success]</text><g class="message" data-participant-1="Processor" data-participant-2="UoW"><polygon fill="#181818" points="1407.3896,720.9648,1417.3896,724.9648,1407.3896,728.9648,1411.3896,724.9648" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="1413.3896" y1="724.9648" y2="724.9648"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="720.2227">19</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55.9927" x="582.1743" y="720.2227">commit()</text></g><g class="message" data-participant-1="UoW" data-participant-2="SQL"><polygon fill="#181818" points="1230.7285,750.2754,1220.7285,754.2754,1230.7285,758.2754,1226.7285,754.2754" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1224.7285" x2="1418.3896" y1="754.2754" y2="754.2754"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1236.7285" y="749.5332">20</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53.4536" x="1257.8799" y="749.5332">COMMIT</text></g><g class="message" data-participant-1="SQL" data-participant-2="UoW"><polygon fill="#181818" points="1407.3896,779.5859,1417.3896,783.5859,1407.3896,787.5859,1411.3896,783.5859" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1219.7285" x2="1413.3896" y1="783.5859" y2="783.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1226.7285" y="778.8438">21</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.5835" x="1247.8799" y="778.8438">ok</text></g><g class="message" data-participant-1="Processor" data-participant-2="Inbox"><polygon fill="#181818" points="918.0718,808.8965,928.0718,812.8965,918.0718,816.8965,922.0718,812.8965" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="924.0718" y1="812.8965" y2="812.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="808.1543">22</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.8472" x="582.1743" y="808.1543">markProcessed(messageId)</text></g><g class="message" data-participant-1="Inbox" data-participant-2="SQL"><polygon fill="#181818" points="1207.7285,838.207,1217.7285,842.207,1207.7285,846.207,1211.7285,842.207" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="930.0718" x2="1213.7285" y1="842.207" y2="842.207"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="937.0718" y="837.4648">23</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244.5054" x="958.2231" y="837.4648">UPDATE inbox SET processed_at=NOW</text></g><g class="message" data-participant-1="SQL" data-participant-2="Inbox"><polygon fill="#181818" points="941.0718,867.5176,931.0718,871.5176,941.0718,875.5176,937.0718,871.5176" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="935.0718" x2="1218.7285" y1="871.5176" y2="871.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="947.0718" y="866.7754">24</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.5835" x="968.2231" y="866.7754">ok</text></g><g class="message" data-participant-1="Processor" data-participant-2="ASB"><polygon fill="#181818" points="131.9409,896.8281,121.9409,900.8281,131.9409,904.8281,127.9409,900.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="125.9409" x2="553.0229" y1="900.8281" y2="900.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="137.9409" y="896.0859">25</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="121.6846" x="159.0923" y="896.0859">complete(message)</text></g><g class="message" data-participant-1="Processor" data-participant-2="Tracer"><polygon fill="#181818" points="817.1436,926.1387,827.1436,930.1387,817.1436,934.1387,821.1436,930.1387" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="823.1436" y1="930.1387" y2="930.1387"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="925.3965">26</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.3784" x="582.1743" y="925.3965">endSpan()</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="20" x2="1475.481" y1="939.1387" y2="939.1387"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="45.0044" x="25" y="949.7734">[failure]</text><g class="message" data-participant-1="Processor" data-participant-2="UoW"><polygon fill="#181818" points="1407.3896,970.4043,1417.3896,974.4043,1407.3896,978.4043,1411.3896,974.4043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="1413.3896" y1="974.4043" y2="974.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="969.6621">27</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.8936" x="582.1743" y="969.6621">rollback()</text></g><g class="message" data-participant-1="Processor" data-participant-2="Inbox"><polygon fill="#181818" points="918.0718,999.7148,928.0718,1003.7148,918.0718,1007.7148,922.0718,1003.7148" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="924.0718" y1="1003.7148" y2="1003.7148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="998.9727">28</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="282.8071" x="582.1743" y="998.9727">recordFailure(messageId, error, attempts++)</text></g><g class="message" data-participant-1="Processor" data-participant-2="ASB"><polygon fill="#181818" points="131.9409,1029.0254,121.9409,1033.0254,131.9409,1037.0254,127.9409,1033.0254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="125.9409" x2="553.0229" y1="1033.0254" y2="1033.0254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="137.9409" y="1028.2832">29</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="309.8799" x="159.0923" y="1028.2832">abandon or dead-letter (after maxDeliveryCount)</text></g><g class="message" data-participant-1="Processor" data-participant-2="Tracer"><polygon fill="#181818" points="817.1436,1058.3359,827.1436,1062.3359,817.1436,1066.3359,821.1436,1062.3359" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="554.0229" x2="823.1436" y1="1062.3359" y2="1062.3359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="561.0229" y="1057.5938">30</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93.5645" x="582.1743" y="1057.5938">endSpan(error)</text></g><!--SRC=[ZLN1Rjim3BtxAuXSvc19TW_G3McReW7Mf6jITBT1iHXNY2rv4fqs6_RlesJNgJslsy6mHJwHZ-IJxFPA5yAA77P6qrBa28Dhp0v8AX63o3LkKfJXrTkO35FKyXyWRQW_JiW05oRFZHvVcbme3MEO7r0JMxKhyuAKqV2aw14MUckUOI4nBpYUJewHACdeCj-YZRwNM7BisO_I8gpH7bI2S5uws9X29GCG3cRhyuZvS6PL24um27bkhKdGEMCXVZ1sZtOOm8svlMLZHO8s8AhFjZjGlCF2E4N67WCks28fI6o5Er7yyZbu-Tr3wiwKLAUfFjkOUwrejVDq0-JUFFJ4k1PQPdMG-hkDwl3qopPWLTAVvLJ6AE9kmlZZgKzJi9YWEc2SyrgaE8B2ciBzh9SBEOB4M8kPy2FrI_8Tv8nCzjSmEWs2mrRDdO8Z9hHcEl7WCTG0w6iRj3OFemeEupOXaH3p0SVRsz73IAQmnLJfsX4tD8TH9JJ6yN2ci5YkvtSRQFomk8BbQWFphulrPXqn9kIjOohjq1BAJn2JBV73JcGEcv1jVg4ub6sao0XaMMHyFWWXhZ5djRTL1ezWoZtDYmofQViGte78B0fvz0FmQ9JzpUM36rexZ923mqvPHsDI-QkqdbadAwkjRbtSyLHIzK9mXezuBReNOXCw5Xoh0dLRyIBGLhpQE8LgzB4C5qGGTqTBmwZ61Xeis2baHaWGQMenvKQwo5j3rYRgB4rVR-CbIwOeicCSD0Quss52hYUs4onpnhTSrS488RYniSOdg0XNadKZbX09VmzC9fDgpgvCVBKz_UMfvegumRngb7YnkhbPR1h51Q3Pzqex5tP_-pBzlslx_lPojfcpQBrnFT-S5FDDqDbozT2LTpTTlmJ_Jsv2PNmJzXHlJPPjHRBlwglcmFUCiVAgsXw_kbxGMcD788Zu5q7k_Vk-yyAti9RyIs6Jv4CoPk9UZx7O-LSkdYynurl37YzCwQ-MDqi96RaUBVtp6m00]--></g></svg>