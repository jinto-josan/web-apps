<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="674px" preserveAspectRatio="none" style="width:1249px;height:674px;background:#FFFFFF;" version="1.1" viewBox="0 0 1249 674" width="1249px" zoomAndPan="magnify"><title>Common-Domain - Outbox Dispatcher to Azure Service Bus</title><defs/><g><text fill="#000000" font-family="'Helvetica'" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="398.2822" x="427.0991" y="25.7803">Common-Domain - Outbox Dispatcher to Azure Service Bus</text><rect fill="none" height="459.6133" style="stroke:#000000;stroke-width:1.5;" width="1233.4805" x="10" y="119.4883"/><rect fill="none" height="311.0605" style="stroke:#000000;stroke-width:1.5;" width="1213.4805" x="20" y="261.041"/><rect fill="none" height="163.8633" style="stroke:#000000;stroke-width:1.5;" width="1136.4688" x="30" y="314.6621"/><g><title>OutboxDispatcher .Worker.</title><rect fill="#000000" fill-opacity="0.00000" height="493.6133" width="8" x="135.5928" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="139" x2="139" y1="102.4883" y2="596.1016"/></g><g><title>OutboxRepository</title><rect fill="#000000" fill-opacity="0.00000" height="493.6133" width="8" x="536.4478" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="539.9858" x2="539.9858" y1="102.4883" y2="596.1016"/></g><g><title>Azure SQL</title><rect fill="#000000" fill-opacity="0.00000" height="493.6133" width="8" x="922.481" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="926.375" x2="926.375" y1="102.4883" y2="596.1016"/></g><g><title>Azure Service Bus Topic</title><rect fill="#000000" fill-opacity="0.00000" height="493.6133" width="8" x="1061.5278" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1064.5869" x2="1064.5869" y1="102.4883" y2="596.1016"/></g><g><title>Tracer</title><rect fill="#000000" fill-opacity="0.00000" height="493.6133" width="8" x="1190.9746" y="102.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1194.4688" x2="1194.4688" y1="102.4883" y2="596.1016"/></g><g class="participant participant-head" data-participant="Dispatcher"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199.1855" x="40" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.1855" x="47" y="91.5352">OutboxDispatcher (Worker)</text></g><g class="participant participant-tail" data-participant="Dispatcher"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="199.1855" x="40" y="595.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="185.1855" x="47" y="615.6367">OutboxDispatcher (Worker)</text></g><g class="participant participant-head" data-participant="Outbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.9238" x="471.9858" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9238" x="478.9858" y="91.5352">OutboxRepository</text></g><g class="participant participant-tail" data-participant="Outbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.9238" x="471.9858" y="595.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9238" x="478.9858" y="615.6367">OutboxRepository</text></g><g class="participant participant-head" data-participant="SQL"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.2119" x="888.375" y="99.5352">Azure SQL</text><path d="M908.481,50 C908.481,40 926.481,40 926.481,40 C926.481,40 944.481,40 944.481,50 L944.481,76 C944.481,86 926.481,86 926.481,86 C926.481,86 908.481,86 908.481,76 L908.481,50" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M908.481,50 C908.481,60 926.481,60 926.481,60 C926.481,60 944.481,60 944.481,50" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="SQL"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70.2119" x="888.375" y="608.6367">Azure SQL</text><path d="M908.481,621.5898 C908.481,611.5898 926.481,611.5898 926.481,611.5898 C926.481,611.5898 944.481,611.5898 944.481,621.5898 L944.481,647.5898 C944.481,657.5898 926.481,657.5898 926.481,657.5898 C926.481,657.5898 908.481,657.5898 908.481,647.5898 L908.481,621.5898" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M908.481,621.5898 C908.481,631.5898 926.481,631.5898 926.481,631.5898 C926.481,631.5898 944.481,631.5898 944.481,621.5898" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="ASB"><path d="M979.5869,76 L1151.4688,76 C1156.4688,76 1156.4688,89.2441 1156.4688,89.2441 C1156.4688,89.2441 1156.4688,102.4883 1151.4688,102.4883 L979.5869,102.4883 C974.5869,102.4883 974.5869,89.2441 974.5869,89.2441 C974.5869,89.2441 974.5869,76 979.5869,76" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1151.4688,76 C1146.4688,76 1146.4688,89.2441 1146.4688,89.2441 C1146.4688,102.4883 1151.4688,102.4883 1151.4688,102.4883" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161.8818" x="979.5869" y="94.5352">Azure Service Bus Topic</text></g><g class="participant participant-tail" data-participant="ASB"><path d="M979.5869,595.1016 L1151.4688,595.1016 C1156.4688,595.1016 1156.4688,608.3457 1156.4688,608.3457 C1156.4688,608.3457 1156.4688,621.5898 1151.4688,621.5898 L979.5869,621.5898 C974.5869,621.5898 974.5869,608.3457 974.5869,608.3457 C974.5869,608.3457 974.5869,595.1016 979.5869,595.1016" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1151.4688,595.1016 C1146.4688,595.1016 1146.4688,608.3457 1146.4688,608.3457 C1146.4688,621.5898 1151.4688,621.5898 1151.4688,621.5898" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="161.8818" x="979.5869" y="613.6367">Azure Service Bus Topic</text></g><g class="participant participant-head" data-participant="Tracer"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57.0117" x="1166.4688" y="71"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.0117" x="1173.4688" y="91.5352">Tracer</text></g><g class="participant participant-tail" data-participant="Tracer"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="57.0117" x="1166.4688" y="595.1016"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43.0117" x="1173.4688" y="615.6367">Tracer</text></g><path d="M10,119.4883 L84.4468,119.4883 L84.4468,126.7988 L74.4468,136.7988 L10,136.7988 L10,119.4883" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="459.6133" style="stroke:#000000;stroke-width:1.5;" width="1233.4805" x="10" y="119.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="25" y="133.0566">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="100.9658" x="99.4468" y="132.123">[every N seconds]</text><g class="message" data-participant-1="Dispatcher" data-participant-2="Outbox"><polygon fill="#181818" points="528.4478,154.1094,538.4478,158.1094,528.4478,162.1094,532.4478,158.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="139.5928" x2="534.4478" y1="158.1094" y2="158.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="146.5928" y="153.3672">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.6816" x="159.1685" y="153.3672">fetchBatch(status=PENDING, limit=100)</text></g><g class="message" data-participant-1="Outbox" data-participant-2="SQL"><polygon fill="#181818" points="914.481,183.4199,924.481,187.4199,914.481,191.4199,918.481,187.4199" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="540.4478" x2="920.481" y1="187.4199" y2="187.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="547.4478" y="182.6777">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="231.3149" x="560.0234" y="182.6777">SELECT ... FOR UPDATE SKIP LOCKED</text></g><g class="message" data-participant-1="SQL" data-participant-2="Outbox"><polygon fill="#181818" points="551.4478,212.7305,541.4478,216.7305,551.4478,220.7305,547.4478,216.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="545.4478" x2="925.481" y1="216.7305" y2="216.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="557.4478" y="211.9883">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94.085" x="570.0234" y="211.9883">outboxEvents[]</text></g><g class="message" data-participant-1="Outbox" data-participant-2="Dispatcher"><polygon fill="#181818" points="150.5928,242.041,140.5928,246.041,150.5928,250.041,146.5928,246.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="144.5928" x2="539.4478" y1="246.041" y2="246.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="156.5928" y="241.2988">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40.771" x="169.1685" y="241.2988">events</text></g><path d="M20,261.041 L82.1387,261.041 L82.1387,268.3516 L72.1387,278.3516 L20,278.3516 L20,261.041" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="311.0605" style="stroke:#000000;stroke-width:1.5;" width="1213.4805" x="20" y="261.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1387" x="35" y="274.6094">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="99.4888" x="97.1387" y="273.6758">[events available]</text><g class="message" data-participant-1="Dispatcher" data-participant-2="Tracer"><polygon fill="#181818" points="1182.9746,295.6621,1192.9746,299.6621,1182.9746,303.6621,1186.9746,299.6621" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="139.5928" x2="1188.9746" y1="299.6621" y2="299.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="146.5928" y="294.9199">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="212.3228" x="159.1685" y="294.9199">startSpan("publish outbox batch")</text></g><path d="M30,314.6621 L104.4468,314.6621 L104.4468,321.9727 L94.4468,331.9727 L30,331.9727 L30,314.6621" fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="163.8633" style="stroke:#000000;stroke-width:1.5;" width="1136.4688" x="30" y="314.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29.4468" x="45" y="328.2305">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="89.0796" x="119.4468" y="327.2969">[for each event]</text><g class="message" data-participant-1="Dispatcher" data-participant-2="ASB"><polygon fill="#181818" points="1053.5278,349.2832,1063.5278,353.2832,1053.5278,357.2832,1057.5278,353.2832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="139.5928" x2="1059.5278" y1="353.2832" y2="353.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="146.5928" y="348.541">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="414.6099" x="159.1685" y="348.541">publish(topic, body, props{messageId, correlationId, traceparent})</text></g><g class="message" data-participant-1="ASB" data-participant-2="Dispatcher"><polygon fill="#181818" points="150.5928,378.5938,140.5928,382.5938,150.5928,386.5938,146.5928,382.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="144.5928" x2="1064.5278" y1="382.5938" y2="382.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="156.5928" y="377.8516">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107.7959" x="169.1685" y="377.8516">brokerMessageId</text></g><g class="message" data-participant-1="Dispatcher" data-participant-2="Outbox"><polygon fill="#181818" points="528.4478,407.9043,538.4478,411.9043,528.4478,415.9043,532.4478,411.9043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="139.5928" x2="534.4478" y1="411.9043" y2="411.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="146.5928" y="407.1621">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="364.2793" x="159.1685" y="407.1621">markDispatched(eventId, dispatchedAt, brokerMessageId)</text></g><g class="message" data-participant-1="Outbox" data-participant-2="SQL"><polygon fill="#181818" points="914.481,437.2148,924.481,441.2148,914.481,445.2148,918.481,441.2148" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="540.4478" x2="920.481" y1="441.2148" y2="441.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="547.4478" y="436.4727">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="349.4575" x="560.0234" y="436.4727">UPDATE outbox SET dispatched_at=NOW, broker_id=...</text></g><g class="message" data-participant-1="SQL" data-participant-2="Outbox"><polygon fill="#181818" points="551.4478,466.5254,541.4478,470.5254,551.4478,474.5254,547.4478,470.5254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="545.4478" x2="925.481" y1="470.5254" y2="470.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="557.4478" y="465.7832">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.5835" x="578.5991" y="465.7832">ok</text></g><g class="message" data-participant-1="Dispatcher" data-participant-2="Tracer"><polygon fill="#181818" points="1182.9746,502.8359,1192.9746,506.8359,1182.9746,510.8359,1186.9746,506.8359" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="139.5928" x2="1188.9746" y1="506.8359" y2="506.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="146.5928" y="502.0938">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="62.3784" x="167.7441" y="502.0938">endSpan()</text></g><line style="stroke:#000000;stroke-width:1;stroke-dasharray:2,2;" x1="20" x2="1233.4805" y1="515.8359" y2="515.8359"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="36.0723" x="25" y="526.4707">[none]</text><g class="message" data-participant-1="Dispatcher" data-participant-2="Dispatcher"><line style="stroke:#181818;stroke-width:1;" x1="139.5928" x2="181.5928" y1="551.1016" y2="551.1016"/><line style="stroke:#181818;stroke-width:1;" x1="181.5928" x2="181.5928" y1="551.1016" y2="564.1016"/><line style="stroke:#181818;stroke-width:1;" x1="140.5928" x2="181.5928" y1="564.1016" y2="564.1016"/><polygon fill="#181818" points="150.5928,560.1016,140.5928,564.1016,150.5928,568.1016,146.5928,564.1016" style="stroke:#181818;stroke-width:1;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="146.5928" y="546.3594">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88.6704" x="167.7441" y="546.3594">sleep(backoff)</text></g><!--SRC=[XLDDRzf04BtlhnZvP4k0qYiIbGWuBGe56gXogAfeR0zXnNh7tLsZqgh_lUkFW0j9Ux3MdddpvisRjTrBNQ317BQitG9pWk0ZgGCvcM8Wx2djf5Dqzs-CecVIsNz0cjthF7K7c72Ui-vFEKUfeG_BqYNy0wRI5kZI7Hbm3EEVfI5Oapd8bE2sj09BnxhC4pB2j_64ia3j86ZAEzNX8vizcIW0j1tMrweUg60h7PjZ3Mw28aE72LgllLNnULwd_Ic-brIU4sTviE52fZLilBxzkzV6O4gcpZMlGYZc0kX0vWWBi9IopgpepD1_tuePmfPywBQAXzQXA-re5I-ciyM77YYPIpTwTtCJYTP4N-TL3c4Tp-F91WQ30Tmj7-3BQZhUnB2-dwrWlfpSnrFXOT3ljE7wZ0-adVtwxSJd4MTPmqgopmjKhdq5FA1Kc2YwaDzCEWIlsRYrDo8CYZ9HqkxQLf1Ku21glDYo0S9qrz1US7b7Xz1MXwuokWS9PySU58OB-oidQ_6PPbaFKZQ653h9klfqbGg_3C_vEnAUvsgYnB2_B9zU6DvOGevcVyfaOIsouizEiR7hNN9TRQLTGpl_Ejvqwf_GZHRBnnUI9vcD_FQkrxGN_WTymskVgPsE12b_VJNhowrq9xUAg0WJJFUytKOrhN_-0000]--></g></svg>