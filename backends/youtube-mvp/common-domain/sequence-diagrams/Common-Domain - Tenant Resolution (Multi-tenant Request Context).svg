<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="569px" preserveAspectRatio="none" style="width:1144px;height:569px;background:#FFFFFF;" version="1.1" viewBox="0 0 1144 569" width="1144px" zoomAndPan="magnify"><title>Common-Domain - Tenant Resolution (Multi-tenant Request Context)</title><defs/><g><text fill="#000000" font-family="'Helvetica'" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="458.8691" x="341.7595" y="25.7803">Common-Domain - Tenant Resolution (Multi-tenant Request Context)</text><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="23.7524" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="27" x2="27" y1="116.4883" y2="488.2148"/></g><g><title>API Controller</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="279.3857" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="283.375" x2="283.375" y1="116.4883" y2="488.2148"/></g><g><title>TokenValidator</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="495.9937" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="499.3892" x2="499.3892" y1="116.4883" y2="488.2148"/></g><g><title>TenantResolver</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="623.7017" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="627.5981" x2="627.5981" y1="116.4883" y2="488.2148"/></g><g><title>TenantRepository</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="836.5708" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="840.0093" x2="840.0093" y1="116.4883" y2="488.2148"/></g><g><title>Azure SQL .tenants.</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="983.2646" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="987.1323" x2="987.1323" y1="116.4883" y2="488.2148"/></g><g><title>UseCase</title><rect fill="#000000" fill-opacity="0.00000" height="371.7266" width="8" x="1098.8926" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1102.397" x2="1102.397" y1="116.4883" y2="488.2148"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="113.5352">Client</text><ellipse cx="27.7524" cy="48.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,56.5 L27.7524,83.5 M14.7524,64.5 L40.7524,64.5 M27.7524,83.5 L14.7524,98.5 M27.7524,83.5 L40.7524,98.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="500.75">Client</text><ellipse cx="27.7524" cy="512.2031" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,520.2031 L27.7524,547.2031 M14.7524,528.2031 L40.7524,528.2031 M27.7524,547.2031 L14.7524,562.2031 M27.7524,547.2031 L40.7524,562.2031" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Controller"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.0215" x="229.375" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.0215" x="236.375" y="105.5352">API Controller</text></g><g class="participant participant-tail" data-participant="Controller"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.0215" x="229.375" y="487.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.0215" x="236.375" y="507.75">API Controller</text></g><g class="participant participant-head" data-participant="TokenValidator"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.209" x="441.3892" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.209" x="448.3892" y="105.5352">TokenValidator</text></g><g class="participant participant-tail" data-participant="TokenValidator"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117.209" x="441.3892" y="487.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103.209" x="448.3892" y="507.75">TokenValidator</text></g><g class="participant participant-head" data-participant="TenantResolver"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.207" x="568.5981" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.207" x="575.5981" y="105.5352">TenantResolver</text></g><g class="participant participant-tail" data-participant="TenantResolver"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="118.207" x="568.5981" y="487.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="104.207" x="575.5981" y="507.75">TenantResolver</text></g><g class="participant participant-head" data-participant="TenantRepo"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.123" x="774.0093" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.123" x="781.0093" y="105.5352">TenantRepository</text></g><g class="participant participant-tail" data-participant="TenantRepo"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="133.123" x="774.0093" y="487.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.123" x="781.0093" y="507.75">TenantRepository</text></g><g class="participant participant-head" data-participant="SQL"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134.2646" x="917.1323" y="113.5352">Azure SQL (tenants)</text><path d="M969.2646,64 C969.2646,54 987.2646,54 987.2646,54 C987.2646,54 1005.2646,54 1005.2646,64 L1005.2646,90 C1005.2646,100 987.2646,100 987.2646,100 C987.2646,100 969.2646,100 969.2646,90 L969.2646,64" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M969.2646,64 C969.2646,74 987.2646,74 987.2646,74 C987.2646,74 1005.2646,74 1005.2646,64" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="SQL"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="134.2646" x="917.1323" y="500.75">Azure SQL (tenants)</text><path d="M969.2646,513.7031 C969.2646,503.7031 987.2646,503.7031 987.2646,503.7031 C987.2646,503.7031 1005.2646,503.7031 1005.2646,513.7031 L1005.2646,539.7031 C1005.2646,549.7031 987.2646,549.7031 987.2646,549.7031 C987.2646,549.7031 969.2646,549.7031 969.2646,539.7031 L969.2646,513.7031" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M969.2646,513.7031 C969.2646,523.7031 987.2646,523.7031 987.2646,523.7031 C987.2646,523.7031 1005.2646,523.7031 1005.2646,513.7031" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="UseCase"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70.9912" x="1067.397" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.9912" x="1074.397" y="105.5352">UseCase</text></g><g class="participant participant-tail" data-participant="UseCase"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="70.9912" x="1067.397" y="487.2148"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="56.9912" x="1074.397" y="507.75">UseCase</text></g><g class="message" data-participant-1="Client" data-participant-2="Controller"><polygon fill="#181818" points="271.3857,143.7988,281.3857,147.7988,271.3857,151.7988,275.3857,147.7988" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="277.3857" y1="147.7988" y2="147.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="34.7524" y="143.0566">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219.0576" x="47.3281" y="143.0566">Request with Authorization header</text></g><g class="message" data-participant-1="Controller" data-participant-2="TokenValidator"><polygon fill="#181818" points="487.9937,173.1094,497.9937,177.1094,487.9937,181.1094,491.9937,177.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="283.3857" x2="493.9937" y1="177.1094" y2="177.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="290.3857" y="172.3672">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="76.3877" x="302.9614" y="172.3672">validate JWT</text></g><g class="message" data-participant-1="TokenValidator" data-participant-2="Controller"><polygon fill="#181818" points="294.3857,202.4199,284.3857,206.4199,294.3857,210.4199,290.3857,206.4199" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="288.3857" x2="498.9937" y1="206.4199" y2="206.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="300.3857" y="201.6777">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180.0322" x="312.9614" y="201.6777">claims { tid, tenant_domain }</text></g><g class="message" data-participant-1="Controller" data-participant-2="TenantResolver"><polygon fill="#181818" points="615.7017,231.7305,625.7017,235.7305,615.7017,239.7305,619.7017,235.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="283.3857" x2="621.7017" y1="235.7305" y2="235.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="290.3857" y="230.9883">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.332" x="302.9614" y="230.9883">resolve(claims, host, headers)</text></g><g class="message" data-participant-1="TenantResolver" data-participant-2="TenantRepo"><polygon fill="#181818" points="828.5708,261.041,838.5708,265.041,828.5708,269.041,832.5708,265.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="627.7017" x2="834.5708" y1="265.041" y2="265.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="634.7017" y="260.2988">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176.2935" x="647.2773" y="260.2988">findByIdOrDomain(tid, host)</text></g><g class="message" data-participant-1="TenantRepo" data-participant-2="SQL"><polygon fill="#181818" points="975.2646,290.3516,985.2646,294.3516,975.2646,298.3516,979.2646,294.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="840.5708" x2="981.2646" y1="294.3516" y2="294.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="847.5708" y="289.6094">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="89.6353" x="860.1465" y="289.6094">SELECT tenant</text></g><g class="message" data-participant-1="SQL" data-participant-2="TenantRepo"><polygon fill="#181818" points="851.5708,319.6621,841.5708,323.6621,851.5708,327.6621,847.5708,323.6621" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="845.5708" x2="986.2646" y1="323.6621" y2="323.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="857.5708" y="318.9199">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="43.6401" x="870.1465" y="318.9199">Tenant</text></g><g class="message" data-participant-1="TenantRepo" data-participant-2="TenantResolver"><polygon fill="#181818" points="638.7017,348.9727,628.7017,352.9727,638.7017,356.9727,634.7017,352.9727" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="632.7017" x2="839.5708" y1="352.9727" y2="352.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="644.7017" y="348.2305">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52.2095" x="657.2773" y="348.2305">tenantId</text></g><g class="message" data-participant-1="TenantResolver" data-participant-2="Controller"><polygon fill="#181818" points="294.3857,378.2832,284.3857,382.2832,294.3857,386.2832,290.3857,382.2832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="288.3857" x2="626.7017" y1="382.2832" y2="382.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="300.3857" y="377.541">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="179.6006" x="312.9614" y="377.541">set RequestContext.tenantId</text></g><g class="message" data-participant-1="Controller" data-participant-2="UseCase"><polygon fill="#181818" points="1090.8926,407.5938,1100.8926,411.5938,1090.8926,415.5938,1094.8926,411.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="283.3857" x2="1096.8926" y1="411.5938" y2="411.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="290.3857" y="406.8516">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.2856" x="311.5371" y="406.8516">execute(context.tenantId, ...)</text></g><g class="message" data-participant-1="UseCase" data-participant-2="Controller"><polygon fill="#181818" points="294.3857,436.9043,284.3857,440.9043,294.3857,444.9043,290.3857,440.9043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="288.3857" x2="1101.8926" y1="440.9043" y2="440.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="300.3857" y="436.1621">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35.877" x="321.5371" y="436.1621">result</text></g><g class="message" data-participant-1="Controller" data-participant-2="Client"><polygon fill="#181818" points="38.7524,466.2148,28.7524,470.2148,38.7524,474.2148,34.7524,470.2148" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="32.7524" x2="282.3857" y1="470.2148" y2="470.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="44.7524" y="465.4727">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="24.6606" x="65.9038" y="465.4727">200</text></g><!--SRC=[XLFBJiCm4BpxArOzjL9J8Ouv89K2eeWt1Ox8D0krSBp1tfIN-7SSEvGwL71pl3Epi-EDUrAcabQMy426JsM9q3j4lKHMSzaJRbLcnHeF_iPeV4HJ_0Con9jrGWUOK5cIoVQebCf01ZCqqZ1SeYDTio83_PDQiyhuk_1SesFFCuolF12oPZ9rUOzMo3cJXObMQ5ZuxhwFgXfIRtm-3GnBMgFjWNHhdobqHazeRgHMXVHg0PfUTU31Lh2xR9NJgytmYfpoMcy9eIBXEyXxwNnIu_VQ8bnT74C_Zku60UnlKibhXnFF2CNsB4GC0RATjJdpLNWlYXSmhdb1LhtBaF82PU7D_g0RRZfu3ijuH3YwdOcq25cdrrnBLJhuy9jK326ES5V4P_xizaaIoy76Kpzg3651ZeUjHJSGANnTeA8S7fGfTj-cnPcDIzKF1Xg97sP53Sj7cSFL_l7-PDOQ54tUMKSmdXFk1izHO5hySjV9nU5gYTiT7gseQIhjO-Q0hpYlsSVHmGzXD1eDH8lxrScdwF-SHBH1XCt8ONjhwmi0]--></g></svg>