<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="598px" preserveAspectRatio="none" style="width:2314px;height:598px;background:#FFFFFF;" version="1.1" viewBox="0 0 2314 598" width="2314px" zoomAndPan="magnify"><title>Common-Domain - Correlation and Trace Context Propagation</title><defs/><g><text fill="#000000" font-family="'Helvetica'" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="415.3652" x="948.4739" y="25.7803">Common-Domain - Correlation and Trace Context Propagation</text><g><title>Client</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="23.7524" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="27" x2="27" y1="116.4883" y2="517.5254"/></g><g><title>API Controller</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="354.6245" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="358.6138" x2="358.6138" y1="116.4883" y2="517.5254"/></g><g><title>TraceProvider .producer.</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="600.2983" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="603.3701" x2="603.3701" y1="116.4883" y2="517.5254"/></g><g><title>CorrelationContext .producer.</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="810.5264" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="814.2266" x2="814.2266" y1="116.4883" y2="517.5254"/></g><g><title>OutboxRepository</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="998.2881" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1001.8262" x2="1001.8262" y1="116.4883" y2="517.5254"/></g><g><title>Azure Service Bus</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="1429.4468" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1432.4614" x2="1432.4614" y1="116.4883" y2="517.5254"/></g><g><title>EventProcessor .consumer.</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="1607.7397" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1611.4321" x2="1611.4321" y1="116.4883" y2="517.5254"/></g><g><title>TraceProvider .consumer.</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="1976.4692" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1979.769" x2="1979.769" y1="116.4883" y2="517.5254"/></g><g><title>CorrelationContext .consumer.</title><rect fill="#000000" fill-opacity="0.00000" height="401.0371" width="8" x="2192.2412" y="116.4883"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="2196.1694" x2="2196.1694" y1="116.4883" y2="517.5254"/></g><g class="participant participant-head" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="113.5352">Client</text><ellipse cx="27.7524" cy="48.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,56.5 L27.7524,83.5 M14.7524,64.5 L40.7524,64.5 M27.7524,83.5 L14.7524,98.5 M27.7524,83.5 L40.7524,98.5" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-tail" data-participant="Client"><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="39.5049" x="5" y="530.0605">Client</text><ellipse cx="27.7524" cy="541.5137" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M27.7524,549.5137 L27.7524,576.5137 M14.7524,557.5137 L40.7524,557.5137 M27.7524,576.5137 L14.7524,591.5137 M27.7524,576.5137 L40.7524,591.5137" fill="none" style="stroke:#181818;stroke-width:0.5;"/></g><g class="participant participant-head" data-participant="Controller"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.0215" x="304.6138" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.0215" x="311.6138" y="105.5352">API Controller</text></g><g class="participant participant-tail" data-participant="Controller"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="108.0215" x="304.6138" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="94.0215" x="311.6138" y="537.0605">API Controller</text></g><g class="participant participant-head" data-participant="TracerP"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181.8564" x="513.3701" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167.8564" x="520.3701" y="105.5352">TraceProvider (producer)</text></g><g class="participant participant-tail" data-participant="TracerP"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="181.8564" x="513.3701" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="167.8564" x="520.3701" y="537.0605">TraceProvider (producer)</text></g><g class="participant participant-head" data-participant="CorrP"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.5996" x="705.2266" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.5996" x="712.2266" y="105.5352">CorrelationContext (producer)</text></g><g class="participant participant-tail" data-participant="CorrP"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="218.5996" x="705.2266" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="204.5996" x="712.2266" y="537.0605">CorrelationContext (producer)</text></g><g class="participant participant-head" data-participant="Outbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.9238" x="933.8262" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9238" x="940.8262" y="105.5352">OutboxRepository</text></g><g class="participant participant-tail" data-participant="Outbox"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="136.9238" x="933.8262" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="122.9238" x="940.8262" y="537.0605">OutboxRepository</text></g><g class="participant participant-head" data-participant="ASB"><path d="M1368.4614,90 L1498.4321,90 C1503.4321,90 1503.4321,103.2441 1503.4321,103.2441 C1503.4321,103.2441 1503.4321,116.4883 1498.4321,116.4883 L1368.4614,116.4883 C1363.4614,116.4883 1363.4614,103.2441 1363.4614,103.2441 C1363.4614,103.2441 1363.4614,90 1368.4614,90" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1498.4321,90 C1493.4321,90 1493.4321,103.2441 1493.4321,103.2441 C1493.4321,116.4883 1498.4321,116.4883 1498.4321,116.4883" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.9707" x="1368.4614" y="108.5352">Azure Service Bus</text></g><g class="participant participant-tail" data-participant="ASB"><path d="M1368.4614,516.5254 L1498.4321,516.5254 C1503.4321,516.5254 1503.4321,529.7695 1503.4321,529.7695 C1503.4321,529.7695 1503.4321,543.0137 1498.4321,543.0137 L1368.4614,543.0137 C1363.4614,543.0137 1363.4614,529.7695 1363.4614,529.7695 C1363.4614,529.7695 1363.4614,516.5254 1368.4614,516.5254" fill="#E2E2F0" style="stroke:#181818;stroke-width:0.5;"/><path d="M1498.4321,516.5254 C1493.4321,516.5254 1493.4321,529.7695 1493.4321,529.7695 C1493.4321,543.0137 1498.4321,543.0137 1498.4321,543.0137" fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="119.9707" x="1368.4614" y="535.0605">Azure Service Bus</text></g><g class="participant participant-head" data-participant="Processor"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196.6152" x="1513.4321" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182.6152" x="1520.4321" y="105.5352">EventProcessor (consumer)</text></g><g class="participant participant-tail" data-participant="Processor"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="196.6152" x="1513.4321" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="182.6152" x="1520.4321" y="537.0605">EventProcessor (consumer)</text></g><g class="participant participant-head" data-participant="TracerC"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187.4004" x="1886.769" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173.4004" x="1893.769" y="105.5352">TraceProvider (consumer)</text></g><g class="participant participant-tail" data-participant="TracerC"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="187.4004" x="1886.769" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173.4004" x="1893.769" y="537.0605">TraceProvider (consumer)</text></g><g class="participant participant-head" data-participant="CorrC"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="224.1436" x="2084.1694" y="85"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210.1436" x="2091.1694" y="105.5352">CorrelationContext (consumer)</text></g><g class="participant participant-tail" data-participant="CorrC"><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="224.1436" x="2084.1694" y="516.5254"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="210.1436" x="2091.1694" y="537.0605">CorrelationContext (consumer)</text></g><g class="message" data-participant-1="Client" data-participant-2="Controller"><polygon fill="#181818" points="346.6245,143.7988,356.6245,147.7988,346.6245,151.7988,350.6245,147.7988" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="27.7524" x2="352.6245" y1="147.7988" y2="147.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="34.7524" y="143.0566">1</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294.2964" x="47.3281" y="143.0566">HTTP request (traceparent?, X-Correlation-Id?)</text></g><g class="message" data-participant-1="Controller" data-participant-2="TracerP"><polygon fill="#181818" points="592.2983,173.1094,602.2983,177.1094,592.2983,181.1094,596.2983,177.1094" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="358.6245" x2="598.2983" y1="177.1094" y2="177.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="365.6245" y="172.3672">2</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.0488" x="378.2002" y="172.3672">startSpan("HTTP", from headers)</text></g><g class="message" data-participant-1="TracerP" data-participant-2="Controller"><polygon fill="#181818" points="369.6245,202.4199,359.6245,206.4199,369.6245,210.4199,365.6245,206.4199" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="363.6245" x2="603.2983" y1="206.4199" y2="206.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="375.6245" y="201.6777">3</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209.0981" x="388.2002" y="201.6777">span + new traceparent if absent</text></g><g class="message" data-participant-1="Controller" data-participant-2="CorrP"><polygon fill="#181818" points="802.5264,231.7305,812.5264,235.7305,802.5264,239.7305,806.5264,235.7305" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="358.6245" x2="808.5264" y1="235.7305" y2="235.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="365.6245" y="230.9883">4</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="265.7256" x="378.2002" y="230.9883">set(correlationId from header or generate)</text></g><g class="message" data-participant-1="CorrP" data-participant-2="Controller"><polygon fill="#181818" points="369.6245,261.041,359.6245,265.041,369.6245,269.041,365.6245,265.041" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="363.6245" x2="813.5264" y1="265.041" y2="265.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="375.6245" y="260.2988">5</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.5835" x="388.2002" y="260.2988">ok</text></g><g class="message" data-participant-1="Controller" data-participant-2="Outbox"><polygon fill="#181818" points="990.2881,290.3516,1000.2881,294.3516,990.2881,298.3516,994.2881,294.3516" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="358.6245" x2="996.2881" y1="294.3516" y2="294.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="365.6245" y="289.6094">6</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="458.4023" x="378.2002" y="289.6094">append(event, metadata{correlationId, causationId=spanId, traceparent})</text></g><g class="message" data-participant-1="Outbox" data-participant-2="ASB"><polygon fill="#181818" points="1421.4468,319.6621,1431.4468,323.6621,1421.4468,327.6621,1425.4468,323.6621" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1002.2881" x2="1427.4468" y1="323.6621" y2="323.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1009.2881" y="318.9199">7</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="394.583" x="1021.8638" y="318.9199">publish with properties {messageId, correlationId, traceparent}</text></g><g class="message" data-participant-1="ASB" data-participant-2="Processor"><polygon fill="#181818" points="1599.7397,348.9727,1609.7397,352.9727,1599.7397,356.9727,1603.7397,352.9727" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1433.4468" x2="1605.7397" y1="352.9727" y2="352.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1440.4468" y="348.2305">8</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="101.5054" x="1453.0225" y="348.2305">deliver message</text></g><g class="message" data-participant-1="Processor" data-participant-2="TracerC"><polygon fill="#181818" points="1968.4692,378.2832,1978.4692,382.2832,1968.4692,386.2832,1972.4692,382.2832" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1611.7397" x2="1974.4692" y1="382.2832" y2="382.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="8.5757" x="1618.7397" y="377.541">9</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="332.1538" x="1631.3154" y="377.541">startSpan("handle event", from message.traceparent)</text></g><g class="message" data-participant-1="TracerC" data-participant-2="Processor"><polygon fill="#181818" points="1622.7397,407.5938,1612.7397,411.5938,1622.7397,415.5938,1618.7397,411.5938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1616.7397" x2="1979.4692" y1="411.5938" y2="411.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1628.7397" y="406.8516">10</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70.5986" x="1649.8911" y="406.8516">active span</text></g><g class="message" data-participant-1="Processor" data-participant-2="CorrC"><polygon fill="#181818" points="2184.2412,436.9043,2194.2412,440.9043,2184.2412,444.9043,2188.2412,440.9043" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="1611.7397" x2="2190.2412" y1="440.9043" y2="440.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1618.7397" y="436.1621">11</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247.7173" x="1639.8911" y="436.1621">set(correlationId from message or new)</text></g><g class="message" data-participant-1="CorrC" data-participant-2="Processor"><polygon fill="#181818" points="1622.7397,466.2148,1612.7397,470.2148,1622.7397,474.2148,1618.7397,470.2148" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1616.7397" x2="2195.2412" y1="470.2148" y2="470.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1628.7397" y="465.4727">12</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="15.5835" x="1649.8911" y="465.4727">ok</text></g><g class="message" data-participant-1="Processor" data-participant-2="ASB"><polygon fill="#181818" points="1444.4468,495.5254,1434.4468,499.5254,1444.4468,503.5254,1440.4468,499.5254" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="1438.4468" x2="1610.7397" y1="499.5254" y2="499.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17.1514" x="1450.4468" y="494.7832">13</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="58.0684" x="1471.5981" y="494.7832">complete</text></g><!--SRC=[XLFBRjim4BppAnOwsQZL3n3G1exQ8hwqHkr3hsjfRHCHIPKF9MtGV- -IaXr9JPCZoPsPdPsbkvUwHOiAZaRxhwW8iZjgElAomaouwxENlg4lhzSqT29Tlr6aZN-P9ob0QPGoElza54eDEP-jfGQzD1fGrx2tMCKgxUdHmzQQ5a_fLM3mHWTr82kmyiP2sKZINh0i2yWMjOTilTqai3LDGpO3TAFZj3GfiK0dQxAmQAsfGqLscK3fqMwdY56lbmPdi5Wn0tqB_c0UlrDhdEIkVwMw_bBy31HuIElVmHBio7QIlTy6bshMkzifq-UExNB35Jd7zXULqIweY_JruLMNKqplidpRvHGMAqeX-lb3_d4quWBkzlijM69hZe4-AZ0z5zwiu4S-8iytzSrIF4CZqJ3s0fpdbdRSq2ABXDaAZjOeE1Eo3RSKGo7aCtN747W7cXvW90to27XmSLkcUYalHf5dYzVEDlLO3NZMlFTaqLFirxuWQ-vdn7t01M3RyfTPK8nk1OeyrkZnQIAsWWg36muVeeDuDsh_prBqV96PrwA0DXmQwSxm8FqPU0LRuW39mPFY5S0J9TAfnfXFC4doS5sQ0cfgPCVD3mpYUT6kkPIJNCxyNVb39skNV0Rm-v7O9QjoBiYVc0LJObEnj5x_3MMGYAbmodqW_t1p7YFAozGgezg6FFq5]--></g></svg>